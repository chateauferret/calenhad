<?xml version="1.0" encoding="UTF-8"?>
<palette>

    <!-- Obligatory modules - behaviour is hardcoded in Calenhad - do not change -->

    <module name="altitudemap" label="Altitude map">
        <documentation>Altitude map</documentation>
        <ports>
            <input index="0" mode="value" name="Input" label="in"/>
        </ports>
    </module>

    <module name="raster" label="Raster">
        <documentation>Raster</documentation>
        <ports>
            <input index="0" mode="defaultValue" name="Input" label="def" default="0.0" />
        </ports>
    </module>

    <module role = "grid" name="cache" label="Cache">
        <documentation>Cache</documentation>
        <ports>
            <input index="0" mode="value" name="Input" label="in" required="true" />
        </ports>
    </module>

    <module role="generate" name="constant" label="Constant" render="false" height="0.25" width="0.75" showName="false">
        <documentation>Constant value</documentation>
        <parameters>
            <parameter type="double" name="value" default="1.0" display="edit">
                <documentation>Constant value</documentation>
                <validator type="AcceptAny"/>
            </parameter>
        </parameters>
        <glsl>%value</glsl>
    </module>

    <!-- Externally programmeable modules -->

    <module role="modify" name="abs" label="Absolute">
        <documentation>Absolute value</documentation>
        <ports>
            <input index="0" mode="value" name="Input" label="in"/>
        </ports>
        <glsl>abs (%0)</glsl>
    </module>

    <module role="modify" name="invert" label="Invert">
        <documentation>Inverse value</documentation>
        <ports>
            <input index="0" mode="value" name="Input" label="in" required="true"/>
        </ports>
        <glsl>- %0</glsl>
    </module>

    <module role="combine" name="add" label="Add">
        <documentation>Addition of two, three or four values</documentation>
        <ports>
            <input index="0" mode="value" name="Input 0" label="in0" default="0.0" />
            <input index="1" mode="value" name="Input 1" label="in1" default="0.0" />
            <input index="2" mode="value" name="Input 2" label="in2" default="0.0" />
            <input index="3" mode="value" name="Input 3" label="in3" default="0.0" />
        </ports>
        <glsl>%0 + %1</glsl>
    </module>

    <module role="combine" name="max" label="Maximum">
        <documentation>Maximum of two, three or four values</documentation>
        <ports>
            <input index="0" mode="value" name="Input 0" label="in0" default="-1.0" />
            <input index="1" mode="value" name="Input 1" label="in1" default="-1.0" />
            <input index="2" mode="value" name="Input 2" label="in2" default="-1.0" />
            <input index="3" mode="value" name="Input 3" label="in3" default="-1.0" />
        </ports>
        <glsl>max (%0, %1)</glsl>
    </module>

    <module role="combine" name="min" label="Minimum">
        <documentation>Minimum of two, three or four values</documentation>
        <ports>
            <input index="0" mode="value" name="Input 0" label="in0" default="1.0" />
            <input index="1" mode="value" name="Input 1" label="in1" default="1.0" />
            <input index="2" mode="value" name="Input 2" label="in2" default="1.0" />
            <input index="3" mode="value" name="Input 3" label="in3" default="1.0" />
        </ports>
        <glsl>min (%0, %1)</glsl>
    </module>

    <module role="combine" name="multiply" label="Multiply">
        <documentation>Product of two, three or four values</documentation>
        <ports>
            <input index="0" mode="value" name="Input 0" label="in0" default="1.0" />
            <input index="1" mode="value" name="Input 1" label="in1" default="1.0" />
            <input index="2" mode="value" name="Input 2" label="in2" default="1.0" />
            <input index="3" mode="value" name="Input 3" label="in3" default="1.0" />
        </ports>
        <glsl>%0 * %1</glsl>
    </module>

    <module role="combine" name="power" label="Power">
        <documentation>Raise base to the power of an exponent</documentation>
        <ports>
            <input index="0" mode="value" name="Base" label="base"/>
            <input index="1" mode="value" name="Exponent" default="2.0" label="exp"/>
        </ports>
        <glsl>pow (%0, %1)</glsl>
    </module>

    <module role="combine" name="diff" label = "Difference">
        <documentation>Subtract a subtrahend from a minuend</documentation>
        <ports>
            <input index="0" mode="value" name="Minuend" label="min"/>
            <input index="1" mode="value" name="Subtrahend" label="sub"/>
        </ports>
        <glsl>%0 - %1</glsl>
    </module>

    <module role="combine" name="blend" label="Blend">
        <documentation>Blend two inputs, weighting each according to the value of a control</documentation>
        <ports>
            <input index="0" mode="value" name="Input 1" label="in1" required="true" />
            <input index="1" mode="value" name="Input 2" label="in2" required="true" />
            <input index="2" mode="control" name="Control" label="ctrl" required="true" />
        </ports>
        <glsl>mix (%0, %1, %2)</glsl>
    </module>

    <module role="transform" name="rotate" label="Rotate">
        <documentation>Rotate the signal around a selected Euler pole</documentation>
        <ports>
            <input index="0" mode="value" name="Input" label="in" required="true" />
            <input index="1" mode="control" name="Latitude" label="lat"/>
            <input index="2" mode="control" name="Longitude" label="lon"/>
            <input index="3" mode="control" name="Rotation" label="theta"/>
        </ports>
        <glsl>
            vec3 pole = toCartesian (vec2 (%2, %1));
            vec3 rc = rotate (radians (%3), pole, c);
            ivec3 fuv = cartesianToIndex (rc);
            vec2 rg = toGeolocation (rc);
            return $0 (fuv, rc, rg);
        </glsl>
    </module>

    <module role="generate" name="cylinders" label="Cylinders">
        <documentation>Cylinder function</documentation>
        <ports>
            <input index="0" mode="value" name="frequency" default="1.0" label="freq">
                <documentation>Frequency of the cylinder function (radius of one cylinder)</documentation>
            </input>
        </ports>
        <glsl>cylinders (c, %0)</glsl>
    </module>

    <module role="generate" name="spheres" label="Spheres">
        <documentation>Sphere function</documentation>
        <ports>
            <input index="0" mode="value" name="frequency" default="1.0"  label="freq">
                <documentation>Frequency of the sphere function (radius of one sphere)</documentation>
            </input>
        </ports>
        <glsl>spheres (c, %0)</glsl>
    </module>

    <module role="combine" name="clamp" label="Clamp">
        <documentation>Clamp the value between minimum and maximum values</documentation>
        <ports>
            <input index="0" mode="value" name="Input" label="in" />
            <input index="1" mode="control" name="minimum" default="-1.0"  label="min" />
            <input index="2" mode="control" name="maximum" default="1.0"  label="max" />
        </ports>
        <glsl>clamp (%0, %1, %2)</glsl>
    </module>

    <module role="convolve" name="Block blur" label="Block blur">
        <documentation>For now a simple block blur filter</documentation>
        <ports>
            <input index="0" mode="value" name="input" required="true" label="in">
                <documentation>Input value</documentation>
            </input>
        </ports>
        <parameters>

        </parameters>
        <glsl>
            float acc = 0.0;
            for (int i = -1; i &lt; 1; i++) {
                for (int j = -1; i &lt; 1; i++) {
                    ivec3 dpos = displace (pos, i, j);
                    acc += 1.0 / 9.0 * $0 (dpos);
                }
            }
            return acc;
        </glsl>
    </module>


    <module role="generate" name="perlin" label="Perlin noise">
        <documentation>Perlin noise function</documentation>
        <ports>
            <input index="0" mode="value" name="frequency" default="1.0"  label="freq">
                <documentation>Frequency of the noise function (radius of one cylinder)</documentation>
            </input>
            <input index="1" mode="value"  name="lacunarity" default="2.0"  label="lac" >
                <documentation>Lacunarity of the noise function</documentation>
            </input>
            <input index="2" mode="value" name="persistence" default="0.5"  label="pers" >
                <documentation>Persistence of the noise function: reduction of amplitude between octaves</documentation>
            </input>
        </ports>
        <parameters>
            <parameter type="integer" name="octaves" default="4">
                <documentation>Number of octaves applied of the noise function</documentation>
                <validator type="AcceptRange" min="1" max="30"/>
            </parameter>
            <parameter type="integer" name="seed" default="0">
                <documentation>Random seed</documentation>
                <validator type="AcceptAny"/>
            </parameter>
        </parameters>
        <glsl>perlin (c, %0, %1, %2, %octaves, %seed)</glsl>
    </module>


    <module role="generate" name="simplex" label="Simplex noise">
        <documentation>Simplex noise function</documentation>
        <ports>
            <input index="0" mode="value" name="frequency" default="1.0"  label="freq" >
                <documentation>Frequency of the noise function (radius of one cylinder)</documentation>
            </input>
            <input index="1" mode="value"  name="lacunarity" default="2.0"  label="lac" >
                <documentation>Lacunarity of the noise function</documentation>
            </input>
            <input index="2" mode="value" name="persistence" default="0.5"  label="pers" >
                <documentation>Persistence of the noise function: reduction of amplitude between octaves</documentation>
            </input>
        </ports>
        <parameters>
            <parameter type="integer" name="octaves" default="4">
                <documentation>Number of octaves applied of the noise function</documentation>
                <validator type="AcceptRange" min="1" max="30"/>
            </parameter>
            <parameter type="integer" name="seed" default="0">
                <documentation>Random seed</documentation>
                <validator type="AcceptAny"/>
            </parameter>
        </parameters>
        <glsl>simplex (c, %0, %1, %2, %octaves, %seed)</glsl>
    </module>

    <module role="generate" name="billow" label="Billow noise">
        <documentation>Perlin noise function</documentation>
        <ports>
            <input index="0" mode="value" name="frequency" default="1.0"  label="freq" >
                <documentation>Frequency of the noise function (radius of one cylinder)</documentation>
            </input>
            <input index="1" mode="value"  name="lacunarity" default="2.0" label="lac" >
                <documentation>Lacunarity of the noise function</documentation>
            </input>
            <input index="2" mode="value" name="persistence" default="0.5"  label="pers" >
                <documentation>Persistence of the noise function: reduction of amplitude between octaves</documentation>
            </input>
        </ports>
        <parameters>
            <parameter type="integer" name="octaves" default="4">
                <documentation>Number of octaves applied of the noise function</documentation>
                <validator type="AcceptRange" min="1" max="30"/>
            </parameter>
            <parameter type="integer" name="seed" default="0">
                <documentation>Random seed</documentation>
                <validator type="AcceptAny"/>
            </parameter>
        </parameters>
        <glsl>billow (c, %0, %1, %2, %octaves, %seed)</glsl>
    </module>

    <module role="generate" name="ridgedmultifractal" label="Ridged multifractal">
        <documentation>Ridged noise function</documentation>
        <ports>
            <input index="0" mode="value" name="frequency" default="1.0"  label="freq" >
                <documentation>Frequency of the noise function (radius of one cylinder)</documentation>
            </input>
            <input index="1" mode="value"  name="lacunarity" default="2.0"  label="lac" >
                <documentation>Lacunarity of the noise function</documentation>
            </input>
        </ports>
        <parameters>
            <parameter type="integer" name="octaves" default="4">
                <documentation>Number of octaves applied of the noise function</documentation>
                <validator type="AcceptRange" min="1" max="30"/>
            </parameter>
            <parameter type="integer" name="seed" default="0">
                <documentation>Random seed</documentation>
                <validator type="AcceptAny"/>
            </parameter>
        </parameters>
        <glsl>ridgedmulti (c, %0, %1, %octaves, %seed, 1.0, 1.0, 2.0, 2.0)</glsl>
    </module>


    <module role="combine" name="scaleandbias" label="Scale and bias">
        <documentation>Scale and bias the input to alter its range</documentation>
        <ports>
            <input index="0" mode="value" name="Input"  label="in"  required="true" />
            <input index="1" mode="control" name="scale" default="1.0"  label="scale" />
            <input index="2" mode="control" name="bias" default="0.0"  label="bias" />
        </ports>
        <glsl>%0 * %1 + %2</glsl>
    </module>

    <module role="combine" name="select" label="Select">
        <documentation>Select one or the other input based on control relative to threshold</documentation>
        <ports>
            <input index="0" mode="value" name="Input 1"  label="in1"  required="true" />
            <input index="1" mode="value" name="Input 2" label="in2"  required="true" />
            <input index="2" mode="control" name="Control"  label="ctrl"  required="true" />
        </ports>
        <parameters>
            <parameter type="double" name="lowerBound" default="-1.0">
                <documentation>Lower bound of the selection range</documentation>
                <validator type="AcceptAny"/>
            </parameter>
            <parameter type="double" name="upperBound" default="1.0">
                <documentation>Upper bound of the selection range</documentation>
                <validator type="AcceptAny"/>
            </parameter>
            <parameter type="double" name="falloff" default="0.1">
                <documentation>Width of the edge falloff range</documentation>
                <validator type="AcceptAny"/>
            </parameter>
        </parameters>
        <glsl>select (%0, %1, %2, %lowerBound, %upperBound, %falloff)</glsl>
    </module>
    <!--
    <module role="transform"  label="Turbulence">
        <documentation>Turbulence function</documentation>
        <ports>
            <input index="0" mode="value" name="input"  label="in" required="true" />
            <input index="1" mode="value" name="frequency" default="1.0" label="freq"  >
                <documentation>Frequency of the turbulence function</documentation>
            </input>
            <input index="2" mode="value"  name="power" default="2.0" label="pow" >
                <documentation>Power of the turbulence function</documentation>
            </input>
            <input index="3" mode="value" name="roughness" default="1.0"  label="rough" >
                <documentation>Roughness of the turbulence</documentation>
            </input>
        </ports>
        <parameters>
            <parameter type="integer" name="octaves" default="4">
                <documentation>Number of octaves applied of the noise function</documentation>
                <validator type="AcceptRange" min="1" max="30"/>
            </parameter>
            <parameter type="integer" name="seed" default="0">
                <documentation>Random seed</documentation>
                <validator type="AcceptAny"/>
            </parameter>
        </parameters>
        <glsl>$0 (turbulence (c, %1, %2, %3, %seed))</glsl>
    </module>
    -->
    <module role="generate" name="voronoi" label="Voronoi noise">
        <documentation>Voronoi noise function</documentation>
        <ports>
            <input index="0" mode="value" name="frequency" default="1.0"  label="freq" >
                <documentation>Frequency of the voronoi function</documentation>
            </input>
            <input index="1" mode="value"  name="displacement" default="0.2" label="disp" >
                <documentation>Displacement of the voronoi function</documentation>
            </input>
        </ports>
        <parameters>
            <parameter type="double" name="scale" default="1.0">
                <documentation>Scaling multiplier applied to the distance function. Positive values produce mountains, negative values produce troughs.</documentation>
                <validator type="AcceptAny"/>
            </parameter>
            <parameter type="integer" name="seed" default="0">
                <documentation>Random seed</documentation>z\a                <validator type="AcceptAny"/>
            </parameter>
        </parameters>
        <glsl>voronoi (c, %0, %1, %scale, %seed)</glsl>

    </module>

</palette>
